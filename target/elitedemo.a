!sal
excludeStart2
start2
  jsr DoDraw
  jsr DoDraw

; Apply velocity
  ldx #3
.cl1
  lda coords,x
  clc
  adc velocity,x
  sta coords,x
  dex
  bpl .cl1

!macro MDoTest .i , .max {
  lda coords + .i
  cmp #4
  bcs .o1
  lda velocity + .i
  bpl .o1
  eor #$ff
  clc
  adc #1
  sta velocity + .i
  jmp .o2
.o1
  cmp #.max
  bcc .o2
  lda velocity + .i
  bmi .o2
  eor #$ff
  clc
  adc #1
  sta velocity + .i
.o2
  }
  +MDoTest 0 , 250
  +MDoTest 1 , 195
  +MDoTest 2 , 250
  +MDoTest 3 , 195
  rts

DoDraw
  ldx #3
.cl2
  lda coords,x
  sta+1 label_6b,x
  dex
  bpl .cl2
  jsr label_b49d
  rts

coords
  !by 100 , 100 , 100, 100
velocity
  !by 1 , 2 , 3 , 4
excludeEnd2